# StreamDiffusion SD1.5 Multi-ControlNet + IPAdapter Configuration
# Demonstrates: TensorRT depth processing, tile with feedback, and IPAdapter integration

# Base model configuration (use HuggingFace model or local path)
model_id: "Lykon/dreamshaper-8"

# StreamDiffusion core parameters
t_index_list: [16, 32]      # Denoising timesteps - lower values = less denoising
width: 512
height: 512
device: "cuda"
dtype: "float16"

# Generation parameters
# prompt: "masterpiece, high quality, detailed, cinematic lighting"  # Overridden by prompt_blending below

# Prompt blending configuration - interpolates between multiple prompts
prompt_blending:
  prompt_list:
    - ["masterpiece, studio ghibli style, detailed anime artwork", 1.0]
    - ["cyberpunk aesthetic, neon lights, futuristic", 0.3]
  interpolation_method: "slerp"  # or "linear"
  enable_caching: true

negative_prompt: "blurry, low quality, distorted, 3d render"
guidance_scale: 1.1
num_inference_steps: 50
seed: 789
lora_dict:
  "/workspace/ComfyUI/models/loras/SD1.5/PixelArt.safetensors": 1.2

# Temporal consistency and optimization
frame_buffer_size: 1
delta: 0.7
use_denoising_batch: true
use_lcm_lora: true
use_tiny_vae: true
acceleration: "tensorrt"   # "xformers" for non-TensorRT setups
cfg_type: "self"

# Engine directory for TensorRT (engines will be built here if not found)
engine_dir: "/workspace/ComfyUI/models/tensorrt/StreamDiffusion-engines/"

# Enable multi-modal conditioning
use_controlnet: true
use_ipadapter: true

# IPAdapter configuration for style conditioning
ipadapters:
  - ipadapter_model_path: "/workspace/ComfyUI/models/ipadapter/ip-adapter-plus_sd15.bin"
    image_encoder_path: "/workspace/ComfyUI/models/ipadapter/image_encoder"
    style_image: "/workspace/ComfyUI/custom_nodes/ComfyUI-StreamDiffusion/assets/style.jpg"
    scale: 0.7
    enabled: true

# ControlNet configurations
controlnets:
  # Canny edge detection for structural guidance
  - model_id: "lllyasviel/control_v11p_sd15_canny"
    conditioning_scale: 0.5
    preprocessor: "canny"
    preprocessor_params:
      low_threshold: 100
      high_threshold: 200
    enabled: true